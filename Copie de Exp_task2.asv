function Exp_task2(target_case,target_presence,setsize,target_key_side,stress)global win0 win1 win2 winclear winblankglobal response_detection response_identification accuracy_detection accuracy_identificationglobal response_time response_time_log excentricity quadrantglobal_settings;% Shapes parametersshapes = {'tilted_line_left','tilted_line_right','vertical_line'}; % target = tilted lines, distractors = vertical linesshape_fixation_dot = 'disc';% Creates the 16 possible spatial locations within a 4 by 4 matrixitem_max_width = settings.LENGTH_SHORT_LINE;item_max_heigth = settings.LENGTH_LONG_LINE;freed_h = round(settings.WIDTH_CELL - settings.MINIMAL_INTER_ITEM_DISTANCE - item_max_width);freed_v = round(settings.WIDTH_CELL - settings.MINIMAL_INTER_ITEM_DISTANCE - item_max_heigth);xnoise=randperm(freed_h);ynoise=randperm(freed_v);l=0;for x=1:4    for y=1:4        l=l+1;        xloc(x) = settings.SCREEN_X/2 - 3*settings.WIDTH_CELL + x*settings.WIDTH_CELL;        yloc(y) = settings.SCREEN_Y/2 - 2*settings.WIDTH_CELL + y*settings.WIDTH_CELL;                xpositions(l) = xloc(x) + settings.MINIMAL_INTER_ITEM_DISTANCE/2 + xnoise(l);        ypositions(l) = yloc(y) - settings.MINIMAL_INTER_ITEM_DISTANCE/2 - ynoise(l);         matloc(l,:)=[xpositions(l),ypositions(l)];         matlocperm=matloc(randperm(l),:) ;    endend%%% prepares screen's items' color and shapespermstsz = randperm(setsize);target = permstsz(1); %defines target% prepares win1 & win2if target_case == 3;% == target tilted left    for i=1:setsize        if i == target            drawshapes(win1,shapes{1},matlocperm(i,1),matlocperm(i,2),settings.TARGET_COLOR);        else            drawshapes(win1,shapes{3},matlocperm(i,1),matlocperm(i,2),settings.NON_TARGETS_COLOR);        end    endendif target_case == 4;% == target tilted right    for i=1:setsize        if i == target            drawshapes(win1,shapes{2},matlocperm(i,1),matlocperm(i,2),settings.TARGET_COLOR);        else            drawshapes(win1,shapes{3},matlocperm(i,1),matlocperm(i,2),settings.NON_TARGETS_COLOR);        end    endend%%% express target's location with center of the screen as reference, for participant's dataX_loc_target = (matlocperm(target,1) - settings.SCREEN_X/2)/settings.CM;Y_loc_target = (matlocperm(target,2) - settings.SCREEN_Y/2)/settings.CM;excentricity = ceil(sqrt(X_loc_target^2 + Y_loc_target^2));half_screen_X = 1;half_screen_Y = 0;if (X_loc_target > 0)    half_screen_X = 2;endif (Y_loc_target > 0)    half_screen_Y = 2;endquadrant = half_screen_X + half_screen_Y;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   EXPERIMENT BEGINS HERE   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIX point ****************************************************************************************************************************************************************************************drawshapes(win0,shape_fixation_dot,(settings.SCREEN_X/2)-2,(settings.SCREEN_Y/2)-2,settings.FIX_POINT_COLOR);Screen(win0,'WaitBlanking',settings.REFRESH_RATE/4);% BLACK screen **************************************************************************************************************************************************Screen('CopyWindow',winclear,win0);Screen(win0,'WaitBlanking',settings.REFRESH_RATE/4);% TEST Screen ***************************************************************************************************************************************************************************************FlushEvents('keyDown'); % or drawnowwhile 1    Screen('CopyWindow',win1,win0);    trial_start_time = tic;    if KbCheck == 1        key = GetChar;        response_time = (toc(trial_start_time))*1000;        break    endendScreen('CopyWindow',winclear,win0);response_time_log = log10(response_time);response_detection = 99;response_identification = 99;if target_key_side == 0    if ((key == 'o') || (key == 'O'))   % If the participant hit the a/A key        response_identification = 0;    % User reported a LEFT TILTED target    end    if ((key == 'P') || (key == 'O'))   % If the participant hit the a/A key        response_identification = 0;    % User reported a LEFT TILTED target    endendif target_key_side == 1    if (key == 32)                      % If the participant hit the space bar        response_detection = 0;         % User didn't detect any target        response_identification = 0;    % User didn't report any target    end    if ((key == 'p') || (key == 'P'))   % If the participant hit the p/P key        response_detection = 1;         % User detected a target        response_identification = 1;    % User reported a LONG LINE target    end    if ((key == 'a') || (key == 'A'))   % If the participant hit the a/A key        response_detection = 1;         % User detected a target        response_identification = 2;    % User reported a T target    endendaccuracy_detection = 0;accuracy_identification = 0;if response_detection == target_presence    accuracy_detection = 1;endif response_identification == target_case    accuracy_identification = 1;endif accuracy_identification == 1    Screen(win0,'WaitBlanking',settings.REFRESH_RATE*2/3);%%%% test fait "passer" KbCheck de 1 a 0else % ERROR MESSAGE ***************************************************************************************************************************************************************************************        if stress == 0        message ='X X X X X X X';        error_message_color = settings.LETTER_COLOR;    else        message = '!!! WRONG !!!';        error_message_color = settings.LETTER_COLOR_STRESS;    end    Screen(win0,'TextFont',settings.LETTER_FONT);    Screen(win0,'TextSize',44);    Screen(win0,'DrawText',message,(settings.SCREEN_X/2)-(3.65*settings.CM),(settings.SCREEN_Y/2)+(settings.CM/3),error_message_color);    Screen(win0,'WaitBlanking',settings.REFRESH_RATE/3);endScreen('CopyWindow',winclear,win1);Screen('CopyWindow',winclear,win0);Screen('CopyWindow',winclear,win2);end